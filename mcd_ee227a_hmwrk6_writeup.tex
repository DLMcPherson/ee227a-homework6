\documentclass[a4paper]{article}

\usepackage{fontspec}
\usepackage{mathpazo}
\setmainfont
     [ BoldFont       = texgyrepagella-bold.otf ,
       ItalicFont     = texgyrepagella-italic.otf ,
       BoldItalicFont = texgyrepagella-bolditalic.otf ]
     {texgyrepagella-regular.otf}
\setmainfont{Gill Sans MT}

\usepackage[english]{babel}
\usepackage[utf8]{inputenc}
\usepackage{amsmath}
\usepackage{graphicx}
\usepackage[colorinlistoftodos]{todonotes}
\usepackage{physics}

%\DeclareMathOperator{\Tr}{Tr}

\title{Convex Optimization - Homework 6: Applications}

\author{David McPherson}

\date{\today}

\begin{document}
\maketitle

\section{Exercise 1: Two Stage Decision Making}
\subsection{Demand Measured prior to Purchase}

The linear program formulation for maximizing profit is:

\begin{equation}
\max \left \{ [\begin{matrix}25 & 10\end{matrix}]\left [\begin{matrix}s_1 \\ s_2 \end{matrix} \right ]
-[\begin{matrix}3.50 & 2.60 & -6.80\end{matrix}] \left [\begin{matrix}x_1 \\ x_2 \\ x_3 \end{matrix} \right ]
\right \}
\end{equation}

subject to

\begin{equation}
s_i \leq D_i , \forall i \in \{1,2\}
\end{equation}
\begin{equation}
s_i \leq y_i , \forall i \in \{1,2\}
\end{equation}
\begin{equation}
\left[
\begin{matrix}
3 & 1 \\
1 & 0 \\
1 & 1 \\
\end{matrix}
\right]
\left[\begin{matrix}y_1 \\ y_2\end{matrix}\right]
\leq
\left[\begin{matrix}x_1 \\ x_2 \\ x_3 \end{matrix}\right]
\end{equation}

where $y_i$ is the quantity of drug $i$ produced, $s_i$ is the quantity of drug $i$ sold, $D_i$ is the quantity of drug $i$ demanded, and $x_i$ is the quantity of ingredient $i$ purchased.

Implementing this formulation in CVX with a demand of $D_1 = 150$ and $D_2 = 200$ yields a profit of \$765 by producing and selling 150 units of Drug 1 and 0 units of Drug 2. To produce this, 450 units of Ingredient 1, 150 units of Ingredient 2, and 150 units of Ingredient 3 were acquired.

\subsection{Profit Maximization for Three Demand Scenarios}
The same formulation (with knowing the demand ahead of purchasing, producing, and selling) was used to maximize profit for each of the three demand scenarios. The maximum profit and associated drug production, selling, and ingredient purchases are filed in Table 1.

\begin{tabular}{c  c  c c  c c c c c}
           & Profit & $s_1$ & $s_2$ & $y_1$ & $y_2$ & $x_1$ & $x_2$ & $x_3$ \\
Scenario 1 &  510   & 100   & 0     & 100   & 0     & 300   & 100   & 100   \\
Scenario 2 &  765   & 150   & 0     & 150   & 0     & 450   & 150   & 150   \\
Scenario 3 & 1020   & 200   & 0     & 200   & 0     & 600   & 200   & 200   \\
\end{tabular}

Note that no amount of Drug 2 was produced, since we produce a \$0.60 loss with each sale.

\subsection{Demand Measured prior to Selling}
Both of the above analyses assume perfect information with demand being known before ingredients are acquired and any manufacturing takes place.
However, a more realistic scenario would be one where we only learn demand after acquisition and assembly has already taken place.
Now we need to optimize one choice of the $x_i$ and $y_1$ such that the expected profit is maximized.
We will use superscripts to denote versions of the variables that depend on the scenario.
In this analysis, we have $s_i^j$ denoting the amount of drug $i$ sold in demand scenario $j$ and $D_i^j$ denoting the demand for drug $i$ in the same scenario $j$.
Therefore our expected profit optimization problem can be formulated as:

\begin{equation}
\max \left \{ [\begin{matrix}25 & 10\end{matrix}]
\left( 0.2 \left [\begin{matrix}s_1^1 \\ s_2^1 \end{matrix} \right ] + 0.5 \left [\begin{matrix}s_1^2 \\ s_2^2 \end{matrix} \right ] + 0.3 \left [\begin{matrix}s_1^3 \\ s_2^3 \end{matrix} \right ] \right)
-[\begin{matrix}3.50 & 2.60 & -6.80\end{matrix}] \left [\begin{matrix}x_1 \\ x_2 \\ x_3 \end{matrix} \right ]
\right \}
\end{equation}

subject to

\begin{equation}
s_i^j \leq D_i^j , \forall i \in \{1,2\} , \forall j \in \{1,2,3\}
\end{equation}
\begin{equation}
s_i^j \leq y_i , \forall i \in \{1,2\} , \forall j \in \{1,2,3\}
\end{equation}
\begin{equation}
\left[
\begin{matrix}
3 & 1 \\
1 & 0 \\
1 & 1 \\
\end{matrix}
\right]
\left[\begin{matrix}y_1 \\ y_2\end{matrix}\right]
\leq
\left[\begin{matrix}x_1 \\ x_2 \\ x_3 \end{matrix}\right]
\end{equation}

Solving this formulation in CVX results in an expected profit of \$515.00 with

\begin{tabular}{c  c  c c  c c c c c}
           & Profit & $s_1$ & $s_2$ & $y_1$ & $y_2$ & $x_1$ & $x_2$ & $x_3$ \\
Scenario 1 & -485   & 100   & 0     &       &       &       &       &       \\
Scenario 2 &  765   & 150   & 0     & 150   & 0     & 450   & 150   & 150   \\
Scenario 3 &  765   & 150   & 0     &       &       &       &       &       \\
\end{tabular}

\subsection{Demand Measured prior to Manufacture}
A slightly better scenario would be if information on the drug demand was received prior to manufacture but after ingredient acquisition.
In this case, we need to optimize one choice of the $x_i$ such that the expected profit is maximized (we can tailor the $y_i$ and $s_i$ to the demand scenario).
Now, our expected profit optimization problem can be formulated as:

\begin{equation}
\max \left \{ [\begin{matrix}25 & 10\end{matrix}]
\left( 0.2 \left [\begin{matrix}s_1^1 \\ s_2^1 \end{matrix} \right ] + 0.5 \left [\begin{matrix}s_1^2 \\ s_2^2 \end{matrix} \right ] + 0.3 \left [\begin{matrix}s_1^3 \\ s_2^3 \end{matrix} \right ] \right)
-[\begin{matrix}3.50 & 2.60 & -6.80\end{matrix}] \left [\begin{matrix}x_1 \\ x_2 \\ x_3 \end{matrix} \right ]
\right \}
\end{equation}

subject to

\begin{equation}
s_i^j \leq D_i^j , \forall i \in \{1,2\} , \forall j \in \{1,2,3\}
\end{equation}
\begin{equation}
s_i^j \leq y_i^j, \forall i \in \{1,2\} , \forall j \in \{1,2,3\}
\end{equation}
\begin{equation}
\left[
\begin{matrix}
3 & 1 \\
1 & 0 \\
1 & 1 \\
\end{matrix}
\right]
\left[\begin{matrix}y_1^j \\ y_2^j\end{matrix}\right]
\leq
\left[\begin{matrix}x_1 \\ x_2 \\ x_3 \end{matrix}\right]
, \forall j \in \{1,2,3\}
\end{equation}

Solving this formulation in CVX results in an expected profit of \$615.00 with

\begin{tabular}{c  c  c c  c c c c c}
           & Profit & $s_1$ & $s_2$ & $y_1$ & $y_2$ & $x_1$ & $x_2$ & $x_3$ \\
Scenario 1 &   15   & 100   & 50    & 100   & 50    &       &       &       \\
Scenario 2 &  765   & 150   & 0     & 150   & 0     & 450   & 150   & 150   \\
Scenario 3 &  765   & 150   & 0     & 150   & 0     &       &       &       \\
\end{tabular}

\section{Exercise 2: Dicsount Factor Curve Fitting }
\subsection{Formulation}
The formulation for this problem is:

\begin{equation}
  \begin{split}
\min_a \sum_{i=1}^I | p_0 f(t_0^{(i)}) +  p_1 f(t_1^{(i)}) |
\\ = \min_a \sum_{i=1}^I | p_0 (a_{0,k_{i0}} + a_{1,k_{i0}} t_0^{(i)} + a_{2,k_{i0}} t_0^{(i) 2} )
+  p_1 (a_{0,k_{i1}} + a_{1,k_{i1}} t_1^{(i)} + a_{2,k_{i1}} t_1^{(i) 2} ) |
  \end{split}
\end{equation}

where $k_{ij}$ is the interval that $t_j^{(i)}$ falls in.

Subject to the constraints:

\begin{equation}
a_{0,k} + a_{1,k} m_{k+1} + a_{2,k} m_{k+1}^2
=
a_{0,k+1} + a_{1,k+1} m_{k+1} + a_{2,k+1} m_{k+1}^2
, \forall k \in \{1,2,\dots,N-1\}
\end{equation}

\begin{equation}
a_{1,k} + 2 a_{2,k} m_{k+1}
=
a_{1,k+1} + 2 a_{2,k+1} m_{k+1}
, \forall k \in \{1,2,\dots,N-1\}
\end{equation}

\begin{equation}
\begin{matrix}
a_{1,k} + 2 a_{2,k} m_k \leq 0
a_{1,k} + 2 a_{2,k} m_{k+1} \leq 0
\end{matrix}
, \forall k \in \{1,2,\dots,N\}
\end{equation}

\begin{equation}
a_{0,N} + a_{1,N} T + a_{2,N} T^2 \geq 0
\end{equation}

\subsection{CVX Solution}

\section{Exercise 3: Probability Density Estimation}
\subsection{Reward Function}

\subsection{Optimization Formulation}

\subsection{CVX Solution}

\subsection{Non-Increasing Requirement}

\subsection{Bounded Slope Requirements}

\end{document}
